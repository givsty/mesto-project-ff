(()=>{"use strict";var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}t.p="";var n={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"561bff47-1094-4520-9c65-f40457c0b35c","Content-Type":"application/json"}};function o(){return fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}))}function r(){return fetch("".concat(n.baseUrl,"/users/me"),{headers:{authorization:n.headers.authorization,"Content-Type":"application/json"},method:"GET"}).then((function(t){return t.json()}))}var a=document.querySelector("#card-template").content;function i(t,e){var o;(o=e,fetch("".concat(n.baseUrl,"/cards/").concat(o),{headers:{authorization:n.headers.authorization,"Content-Type":"application/json"},method:"DELETE"}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}))).then((function(e){console.log(e),t.target.closest(".places__item").remove()})).catch((function(t){console.log(t)})),t.target.closest(".places__item").remove()}function c(t,e,o){var r=o.likesValue;(function(t){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:n.headers.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}))})(e).then((function(e){r.textContent=e.likes.length,t.target.classList.add("card__like-button_is-active")})).catch((function(t){console.log(t)})).finally((function(){}))}function u(t){t.classList.add("popup_is-animated"),setTimeout((function(){t.classList.add("popup_is-opened")})),document.addEventListener("keydown",l)}function s(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function l(t){"Escape"===t.key&&s(document.querySelector(".popup_is-opened"))}const p=t.p+"fc3e6875d825f899a98d.svg";function d(t){var e=t.inputList,n=t.inactiveButtonClass,o=t.buttonElement;!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(o.disabled=!1,o.classList.remove(n)):(o.disabled=!0,o.classList.add(n))}function f(t,e,n,o){var r=t.querySelector(".".concat(o.name,"-input-error"));o.classList.remove(e),r.classList.add(n),r.textContent=""}function m(t,e){var n=e.inputSelector,o=e.inputErrorClass,r=e.errorClass;Array.from(t.querySelectorAll(n)).forEach((function(e){e.addEventListener("input",(function(){f(t,o,r,e)}))}))}var _=document.querySelector(".profile__add-button"),y=document.querySelector(".profile__image"),h=document.querySelector(".profile__edit-button"),v=document.querySelector(".places").querySelector(".places__list"),b=document.querySelectorAll(".popup"),S=document.querySelector(".header__logo"),C=document.forms["edit-profile"],k=document.forms["new-place"],E=document.forms.avatar,g=(document.querySelector(".popup__button"),document.querySelector(".profile__title")),q=document.querySelector(".profile__description"),L=document.querySelector(".popup_type_edit"),j=document.querySelector(".popup_type_avatar"),T=L.querySelector(".popup__input_type_name"),z=L.querySelector(".popup__input_type_description"),P=document.querySelector(".popup_type_new-card"),A=k.querySelector(".popup__input_type_card-name"),x=k.querySelector(".popup__input_type_url"),B=document.querySelector(".popup_type_image"),w=B.querySelector(".popup__image"),U=B.querySelector(".popup__caption"),D=E.querySelector(".popup__input_type_url");S.src=p;var V,I,O,N,J,M,H,G={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function F(t,e){var o=function(t){var e=t.name,o=t.link,r=t.deleteCard,i=t.likeCard,c=t.handleImageClick,u=t.likes,s=t._id,l=t.profile_id,p=a.querySelector(".places__item").cloneNode(!0),d=p.querySelector(".card__title"),f=p.querySelector(".card__image"),m=p.querySelector(".card__delete-button"),_=p.querySelector(".card__like-button"),y=p.querySelector(".card__like-counter");m.addEventListener("click",(function(t){r(t,s)})),_.addEventListener("click",(function(t){h?(function(t,e,o){var r=o.likesValue;(function(t){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:n.headers.authorization,"Content-Type":"application/json"}}).then((function(t){if(t.ok)return t.json();Promise.reject("Ошибка ".concat(t.status))}))})(e).then((function(e){r.textContent=e.likes.length,t.target.classList.remove("card__like-button_is-active")})).catch((function(t){console.log(t)})).finally((function(){}))}(t,s,{likes:u,likesValue:y}),h=!1):(i(t,s,{likes:u,likesValue:y}),h=!0)}));var h=u.some((function(t){return"f87cc046b58a155a69a0b23e"===t._id}));return h&&_.classList.add("card__like-button_is-active"),f.addEventListener("click",(function(){c(e,o)})),"f87cc046b58a155a69a0b23e"!==l&&m.remove(),d.textContent=e,f.src=o,f.alt=e,y.textContent=u.length,p}(t);v[e](o)}function K(t,e){w.src=e,w.alt=t,U.textContent=t,u(B)}function Q(t){b.forEach((function(e){e.classList.contains("popup_is-opened")&&Array.from(e.querySelectorAll(".popup__form")).forEach((function(e){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"}))}))}I=(V=G).formSelector,O=V.inputSelector,N=V.submitButtonSelector,J=V.inactiveButtonClass,M=V.inputErrorClass,H=V.errorClass,Array.from(document.querySelectorAll(I)).forEach((function(t){var e=Array.from(t.querySelectorAll(O));!function(t){var e=t.formElement,n=t.inputList,o=t.submitButtonSelector,r=t.inactiveButtonClass,a=t.inputErrorClass,i=t.errorClass,c=e.querySelector(o);d({inputList:n,inactiveButtonClass:r,buttonElement:c}),n.forEach((function(t){t.addEventListener("input",(function(o){o.preventDefault(),d({inputList:n,inactiveButtonClass:r,buttonElement:c}),function(t){var e=t.formElement,n=t.inputElement,o=t.inputErrorClass,r=t.errorClass;n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?f(e,o,r,n):function(t,e,n,o,r){var a=t.querySelector(".".concat(r.name,"-input-error"));r.classList.add(n),a.classList.add(o),a.textContent=e}(e,n.validationMessage,o,r,n)}({formElement:e,inputElement:t,inputErrorClass:a,errorClass:i})}))}))}({formElement:t,inputList:e,submitButtonSelector:N,inactiveButtonClass:J,inputErrorClass:M,errorClass:H})})),r().then((function(t){Q(!0),g.textContent=t.name,q.textContent=t.about,y.style.backgroundImage="url('".concat(t.avatar,"')")})).catch((function(t){console.log(t)})).finally((function(){Q(!1)})),o().then((function(t){Array.from(t).forEach((function(t){F({name:t.name,link:t.link,likeCard:c,deleteCard:i,handleImageClick:K,likes:t.likes,_id:t._id,profile_id:t.owner._id},"prepend")}))})).catch((function(t){console.log(t)})).finally((function(){})),Promise.all([o,r]).then((function(t){})),k.addEventListener("submit",(function(t){var o,r,a,u;Q(!0),(o={likes:[],_id:"f87cc046b58a155a69a0b23e",name:A.value,link:x.value},fetch("".concat(n.baseUrl,"/cards"),(r={headers:{authorization:n.headers.authorization,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:o.name,link:o.link,_id:o._id})},a="headers",u=n.headers,(a=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(a))in r?Object.defineProperty(r,a,{value:u,enumerable:!0,configurable:!0,writable:!0}):r[a]=u,r)).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}))).then((function(t){F({name:t.name,link:t.link,deleteCard:i,likeCard:c,handleImageClick:K,likes:t.likes,_id:t._id,profile_id:t.owner._id},"prepend")})).catch((function(t){console.log(t)})).finally((function(){Q(!1)})),m(k,G),s(P),t.preventDefault()})),_.addEventListener("click",(function(t){u(P)})),h.addEventListener("click",(function(){r().then((function(t){var e=t.name,n=t.about;T.setAttribute("value",e),z.setAttribute("value",n)})).catch((function(t){console.log(t)})),u(L)})),y.addEventListener("click",(function(t){t.preventDefault(),u(j)})),C.addEventListener("submit",(function(t){var e;t.target.querySelector(".popup__button").textContent="Сохранение...",(e={name:T.value,about:z.value},fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:n.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,about:e.about})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}))).then((function(t){g.textContent=t.name,q.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){Q(!1),s(L),m(C,G)})),t.preventDefault()})),E.addEventListener("submit",(function(t){var e;Q(!0),(e=D.value,fetch("".concat(n.baseUrl,"/users/me/avatar"),{headers:{authorization:n.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:e}),method:"PATCH"}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}))).then((function(t){y.style.backgroundImage="url('".concat(t.avatar,"')")})).catch((function(t){console.log(t)})).finally((function(){Q(!1),s(j)})),t.preventDefault()})),b.forEach((function(t){t.addEventListener("mousedown",(function(e){(e.target.classList.contains("popup_is-opened")||e.target.classList.contains("popup__close"))&&s(t)}))}))})();